[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
user=root

; ---------------------------------------------------------------------------
; nginx — serves React SPA on port 8080, proxies /api/ to gunicorn
; ---------------------------------------------------------------------------
[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

; ---------------------------------------------------------------------------
; gunicorn — FastAPI application on internal port 8000
; ---------------------------------------------------------------------------
[program:gunicorn]
command=gunicorn app.main:app
    --worker-class uvicorn.workers.UvicornWorker
    --workers 2
    --bind 0.0.0.0:8000
    --timeout 120
    --graceful-timeout 30
    --keep-alive 5
    --access-logfile -
    --error-logfile -
directory=/app/backend
user=appuser
autostart=true
autorestart=true
priority=20
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
